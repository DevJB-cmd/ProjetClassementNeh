{% extends "core/base.html" %}
{% load static %}

{% block title %}Export PDF (Paysage){% endblock %}

{% block content %}

<style>
    /* Page en paysage - A4 */
    @page {
        size: A4 landscape;
        margin: 15mm 15mm 15mm 15mm;
    }

    /* Si votre moteur PDF ignore @page, vous pouvez aussi régler via l'outil (wkhtmltopdf --orientation Landscape) */

    body {
        font-family: Arial, sans-serif;
        color: #000;
        margin: 0;
        padding: 0;
    }

    /* Conteneur full-width pour profiter du paysage */
    .pdf-container {
        width: 100%;
        box-sizing: border-box;
        padding: 12px;
        background: #f5f5f5;
    }

    h1 {
        text-align: center;
        font-size: 28px;
        margin: 6px 0 10px 0;
    }

    .date-info {
        text-align: center;
        font-size: 12px;
        margin-bottom: 14px;
        color: #555;
    }

    .group-title {
        font-size: 18px;
        font-weight: bold;
        margin-top: 16px;
        margin-bottom: 8px;
    }

    /* Tableau en full width */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 18px;
        table-layout: fixed; /* permet de gérer les colonnes en paysage */
        word-wrap: break-word;
    }

    th, td {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: left;
        font-size: 12px;
        vertical-align: middle;
    }

    th {
        background-color: #007bff;
        color: #fff;
        font-size: 13px;
    }

    /* proportions des colonnes :
       - N° : étroite
       - Nom & Prénom : large
       - Université : moyenne
       - Cohorte : petite
       - Appel : petite (case)
    */
    colgroup col:nth-child(1) { width: 6%; }
    colgroup col:nth-child(2) { width: 42%; }
    colgroup col:nth-child(3) { width: 26%; }
    colgroup col:nth-child(4) { width: 12%; }
    colgroup col:nth-child(5) { width: 14%; }

    tr:nth-child(even) td {
        background-color: #f0f7ff;
    }

    .empty-row {
        text-align: center;
        font-style: italic;
        color: #777;
    }

    /* Option : case imprimable pour 'Appel' */
    .appel-box {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 1px solid #333;
        vertical-align: middle;
        margin-right: 6px;
    }
</style>

<div class="pdf-container">

    <h1>Liste des Groupes</h1>
    <p class="date-info">{{ date }}</p>

    {% for data in groupes %}
        <h2 class="group-title">
            {{ data.groupe.nom }} — {{ data.groupe.get_genre_display }}
            ({{ data.taille_actuelle }} étudiants)
        </h2>

        <table>
            <!-- on définit des largeurs via colgroup -->
            <colgroup>
                <col />
                <col />
                <col />
                <col />
                <col />
            </colgroup>

            <thead>
                <tr>
                    <th>N°</th>
                    <th>Nom & Prénom</th>
                    <th>Université</th>
                    <th>Cohorte</th>
                    <th>Appel</th>
                </tr>
            </thead>
            <tbody>
                {% for etudiant in data.etudiants %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ etudiant.nom }} {{ etudiant.prenom }}</td>
                        <td>{{ etudiant.universite }}</td>
                        <!-- Adapter si votre champ cohorte a un autre nom (ex: etudiant.annee_inscription) -->
                        <td>{{ etudiant.get_cohorte_display}}</td>
                        <!-- Case vide imprimable pour l'appel -->
                        <td><span class="appel-box"></span>Présent / Absent</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="empty-row">Aucun étudiant dans ce groupe.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endfor %}

</div>

{% endblock %}
